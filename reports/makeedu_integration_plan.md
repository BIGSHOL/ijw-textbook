# 메이크에듀(MakeEdu) 연동 크롬 확장프로그램 개발 계획서

## 1. 목표 (Goal)
`school.makeedu.co.kr` (메이크에듀)에서 발생하는 **'학생 등록'** 및 **'납부 완료'** 이벤트를 감지하여, 이를 `ijw-textbook.web.app` (교재 주문 시스템)의 데이터베이스에 자동으로 동기화합니다.
즉, 메이크에듀에서 처리하면 교재 시스템에서도 자동으로 **[등록]** 및 **[납부]** 체크가 되도록 만듭니다.

## 2. 시스템 아키텍처 (Architecture)
- **형태**: 크롬 브라우저 확장프로그램 (Chrome Extension Manifest V3)
- **동작 방식**:
    1.  **사용자**가 메이크에듀 사이트에서 작업(등록/납부)을 수행합니다.
    2.  **확장프로그램(Content Script)**이 이 동작을 감지하고 학생 이름과 처리 내용을 추출합니다.
    3.  **확장프로그램(Background Script)**이 추출된 정보를 바탕으로 파이어베이스(Firestore)에 접속하여 해당 학생의 교재 신청 내역 상태를 업데이트합니다.

## 3. 구현 내용 (Proposed Changes)

### 3.1 프로젝트 구조
프로젝트 루트에 `makeedu-ext`라는 별도의 폴더를 생성하여 확장프로그램 코드를 관리합니다.

### 3.2 주요 구성 요소

#### `manifest.json` 설정
-   **권한**:
    -   `storage`: 로그인 정보 저장
    -   `scripting`, `activeTab`: 메이크에듀 사이트 제어
-   **호스트 권한**: `*://school.makeedu.co.kr/*` (메이크에듀 사이트 접근 허용)

#### `firebaseConfig.js`
-   기존 웹앱과 동일한 파이어베이스 설정을 사용하여 DB에 접근합니다.

#### `background.js` (백그라운드 스크립트)
-   **역할**: 파이어베이스 Firestore와 직접 통신하는 중계자.
-   **로직**:
    1.  Content Script로부터 `{ action: 'REGISTER', name: '홍길동' }` 같은 메시지를 받습니다.
    2.  Firestore의 `requests` 컬렉션에서 '홍길동' 학생의 최신 신청 내역을 찾습니다.
    3.  해당 문서의 `isCompleted`(등록 여부) 또는 `isPaid`(납부 여부) 필드를 `true`로 변경하고, 처리 일시(`completedAt`, `paidAt`)를 현재 시간으로 기록합니다.
    4.  성공/실패 결과를 Content Script로 반환합니다.

#### `content.js` (콘텐츠 스크립트)
-   **역할**: 메이크에듀 웹페이지 화면을 보고 있다가 특정 상황을 감지합니다.
-   **구현 단계**:
    -   **1단계 (초기)**: 메이크에듀 화면 한구석에 **[교재 시스템 연동]** 버튼을 띄웁니다. 사용자가 학생 작업 후 이 버튼을 누르면 연동되게 합니다. (HTML 구조를 모르기 때문에 가장 확실한 방법입니다)
    -   **2단계 (자동화)**: 메이크에듀의 "저장 완료" 팝업이나 버튼 클릭 이벤트를 자동으로 감지하여 버튼을 누를 필요 없이 자동 처리되게 개선합니다.

#### `popup.html` / `popup.js`
-   확장프로그램 아이콘 클릭 시 나오는 작은 창입니다.
-   **기능**:
    -   **로그인**: 교재 시스템 관리자 계정으로 로그인 (DB 쓰기 권한 획득용).
    -   **연결 상태 확인**: 현재 시스템과 잘 연결되어 있는지 표시.

## 4. 사용자 협조 요청 사항 (User Review Required)
> [!IMPORTANT]
> **HTML 구조 분석 필요**:
> 제가 메이크에듀 사이트에 접속할 수 없으므로, 자동화를 위해서는 **"등록 완료"** 또는 **"납부 처리"** 화면의 HTML 구조 정보가 반드시 필요합니다.
>
> **1차 목표**: 우선 수동 트리거(버튼 형태)로 기능을 개발하여 드리고, 사용하시면서 해당 화면의 코드나 스크린샷을 공유해주시면 **완전 자동화**로 업그레이드하는 순서를 제안드립니다.

## 5. 검증 계획 (Verification Plan)
이 기능은 로컬 환경(내 컴퓨터)에서 크롬 브라우저에 직접 설치하여 테스트해야 합니다.

1.  크롬 주소창에 `chrome://extensions` 입력.
2.  우측 상단 **[개발자 모드]** 켜기.
3.  **[압축해제된 확장 프로그램을 로드합니다]** 클릭 후 `makeedu-ext` 폴더 선택.
4.  확장프로그램 아이콘을 눌러 구글 로그인.
5.  메이크에듀 사이트 접속 후 기능 동작 확인.
